<?php

use CodeIgniter\Router\RouteCollection;

/**
 * @var RouteCollection $routes
 */

// Ruta por defecto - redirigir al login
$routes->get('/', 'Auth::login');

// Rutas de autenticación
$routes->group('auth', function($routes) {
    $routes->get('login', 'Auth::login');
    $routes->post('loginProcesar', 'Auth::loginProcesar');
    $routes->get('registro', 'Auth::registro');
    $routes->post('registroProcesar', 'Auth::registroProcesar');
    $routes->get('logout', 'Auth::logout');
});

// Rutas de administrador
$routes->group('admin', function($routes) {
    $routes->get('dashboard', 'Admin::dashboard');
    $routes->get('usuarios', 'Admin::usuarios');
    $routes->get('crearUsuario', 'Admin::crearUsuario');
    $routes->post('guardarUsuario', 'Admin::guardarUsuario');
    $routes->get('editarUsuario/(:num)', 'Admin::editarUsuario/$1');
    $routes->post('actualizarUsuario/(:num)', 'Admin::actualizarUsuario/$1');
    $routes->get('eliminarUsuario/(:num)', 'Admin::eliminarUsuario/$1');
    $routes->get('cambiarEstado/(:num)', 'Admin::cambiarEstado/$1');
});

// Rutas de visitante
$routes->group('visitante', function($routes) {
    $routes->get('dashboard', 'Visitante::dashboard');
    $routes->get('perfil', 'Visitante::perfil');
    $routes->post('editarPerfil', 'Visitante::editarPerfil');
});

// Ruta genérica para dashboard según rol
$routes->get('dashboard', function() {
    if (!session()->has('usuario_id')) {
        return redirect()->to('/auth/login');
    }
    
    if (session()->get('usuario_rol') == 'admin') {
        return redirect()->to('/admin/dashboard');
    } else {
        return redirect()->to('/visitante/dashboard');
    }
});
